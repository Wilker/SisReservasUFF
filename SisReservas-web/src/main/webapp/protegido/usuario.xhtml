<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./../template/template.xhtml">
            <ui:define name="content">
                <h1 style="text-align: center" >Manutenção de Usuários</h1>
                <p:commandButton icon="ui-icon-plusthick" value="Novo" onclick="PF('wdialogo').show();" />

                <p:dialog id="dialogo" widgetVar="wdialogo" header="Cadastrar Usuário" resizable="false" closeOnEscape="true" draggable="false" >
                    <h:form >
                        <p:growl id="mensagem" autoUpdate="false" severity="info, fatal" showDetail="true" />
                        <h:panelGrid id="pgGeral" columns="2" style="margin: 0 auto;">
                            <p:fieldset legend="Dados do Usuário">
                                <h:panelGrid columns="3" id="pgDadosUsuario">
                                    <p:outputLabel for="txtNome" value="Nome" />

                                    <p:inputText id="txtNome" value="#{usuarioController.pessoa.nome}" required="true" requiredMessage="O nome é obrigatório!" />

                                    <p:message for="txtNome" /> 

                                    <p:outputLabel for="txtCPF" value="CPF" />

                                    <p:inputText id="txtCPF" value="#{usuarioController.pessoa.cpf}" required="true" requiredMessage="O CPF é obrigatório!" />

                                    <p:message for="txtCPF" /> 

                                    <p:outputLabel for="txtTelefone" value="Telefone" />

                                    <p:inputText id="txtTelefone" value="#{usuarioController.pessoa.telefone}" required="true" requiredMessage="O telefone é obrigatório!" />

                                    <p:message for="txtTelefone" /> 

                                    <p:outputLabel for="txtEndereco" value="Endereço" />

                                    <p:inputText id="txtEndereco" value="#{usuarioController.pessoa.endereco}" required="true" requiredMessage="O endereço é obrigatório!" />

                                    <p:message for="txtEndereco" />         

                                </h:panelGrid>
                            </p:fieldset>       
                            <p:fieldset legend="Dados da Conta">
                                <h:panelGrid  columns="3" id="pgDadosConta">
                                    <p:outputLabel for="tipo" value="Tipo de Usuário" />

                                    <p:selectOneMenu id="tipo" value="#{usuarioController.usuario.tipo}" required="true" 
                                                     requiredMessage="O tipo de usuário é obrigatório!"  >
                                        <f:selectItem itemValue="A" itemLabel="Administrador" />
                                        <f:selectItem itemValue="P" itemLabel="Usuário Padrão" />
                                    </p:selectOneMenu>

                                    <p:message for="tipo"  />

                                    <p:outputLabel for="txtEmail" value="E-mail" />

                                    <p:inputText id="txtEmail" value="#{usuarioController.usuario.email}" required="true" requiredMessage="O e-mail é obrigatório!" />

                                    <p:message for="txtEmail" /> 

                                    <p:outputLabel for="senha" value="Senha" />

                                    <p:password id="senha" value="#{usuarioController.usuario.senha}" required="true"
                                                feedback="true" promptLabel="Insira uma senha" weakLabel="Fraca"
                                                goodLabel="Boa" strongLabel="Forte" match="conf_senha"
                                                validatorMessage="As senhas não coincidem" requiredMessage="A senha é obrigatória!"/>

                                    <p:message for="senha" />

                                    <p:outputLabel for="conf_senha" value="Confirmar Senha" />

                                    <p:password id="conf_senha" required="true" requiredMessage="A confirmação de senha é obrigatória!"/>

                                    <p:message for="conf_senha" />

                                </h:panelGrid>

                            </p:fieldset>
                            <p:commandButton value="Cancelar" icon="ui-icon-close" style="float:right" immediate="true" onclick="PF('wdialogo').hide();" />
                             <p:commandButton value="Cadastrar" icon="ui-icon-"  update="pgDadosConta, pgDadosUsuario, mensagem :formTabela:tabela" actionListener="#{usuarioController.cadastrarPeloAdministrador()}" />
                        </h:panelGrid>

                    </h:form>
                </p:dialog>



                <p:separator/>

                <h:form id="formTabela">
                    <p:dataTable  id="tabela" value="#{usuarioController.usuarios}" var="usuario" >
                        <p:column headerText="Usuário">
                            <h:outputText value="#{usuario.idUsuario.nome}" />
                        </p:column>
                        <p:column headerText="E-mail">
                            <h:outputText value="#{usuario.email}" />
                        </p:column>                        
                        <p:column headerText="CPF" >
                            <h:outputText value="#{usuario.idUsuario.cpf}" />
                        </p:column>
                        <p:column headerText="Endereço" >
                            <h:outputText value="#{usuario.idUsuario.endereco}" />
                        </p:column>
                        <p:column headerText="Telefone" >
                            <h:outputText value="#{usuario.idUsuario.telefone}" />
                        </p:column>                        
                        <p:column headerText="Ações">
                            <h:commandLink value="Visualizar" style="margin-right: 10px" />
                            <h:commandLink value="Editar" actionListener="#{usuarioController.exibir(usuario)}" style="margin-right: 10px" />
                            <h:commandLink value="Excluir" actionListener="#{usuarioController.excluir(usuario)}" />
                        </p:column>
                    </p:dataTable>

                </h:form>
            </ui:define>
        </ui:composition>

    </body>
</html>
